<!DOCTYPE html>
<html>
	<title>MyVIBO</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<!--<link rel="stylesheet" href="css/jquery.mobile-1.3.2.min.css" />--><!--JQuery Mobile theme-->
	<link rel="stylesheet" href="css/jquery.mobile.structure-1.3.2.min.css" />
	<link rel="stylesheet" href="css/myvibo.min.css" /><!--將JQuery Mobile theme加上 swatch="F"-->
	<link rel="stylesheet" href="css/jquery.mobile.simpledialog.min.css" /><!--類似alert的dialog，請參考 http://dev.jtsage.com/jQM-SimpleDialog/demos2/ -->
	<link rel="stylesheet" href="css/style.css" />
	
	<script src="js/jquery-1.10.2.min.js"></script>
	<script type="text/javascript" src="js/initJQueryMobile.js"></script><!--初始化 JQuery Mobile -->
	<script src="js/jquery.mobile-1.3.2.min.js"></script>
	<!--<script src="js/jquery.touchSwipe.min.js"></script>-->
	<!--<script src="js/jquery.carouFredSel-6.2.1-packed.js"></script>-->
	<script src="js/jquery.mobile.simpledialog2.min.js"></script><!--類似alert的dialog，請參考 http://dev.jtsage.com/jQM-SimpleDialog/demos2/ -->
	<script type="text/javascript" src="js/util.js"></script>
	<script type="text/javascript" src="js/ga.js"></script><!--Browser用的Google Analytics 追蹤函數-->
	<script type="text/javascript" src="js/jquery.cookie.js"></script><!--Browser用的Cookie函數，請參考 https://github.com/carhartl/jquery-cookie -->
	<script type="text/javascript" src="js/jquery.blockUI.js"></script><!--JQuery BlockUI，請參考http://www.malsup.com/jquery/block/ -->
	<!--<script type="text/javascript" src="https://maps.google.com/maps/api/js?sensor=true&region=TW&language=zh-TW"></script>-->
	
	<script src="cordova.js"></script><!--給PhoneGap用的-->
	<!--<script src="GAPlugin.js"></script>--><!--APP用的Google Analytics 追蹤函數，請參考 https://github.com/phonegap-build/GAPlugin -->
	<script type="text/javascript" src="js/initPhoneGap.js"></script><!--初始化PhoneGap-->
	
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
</head>

<body>

<!-- ****************************** 選單頁 ***********************************-->
<div data-role="page" id="myCustomerMenu">
	<div data-role="header" data-position="fixed" class="vibo-header">
		<div class="header-padding">我的客服</div>
	</div><!-- /header -->
	
	<div data-role="content">
		<ul data-role="listview" data-inset="false" data-theme="h" data-icon="false" class="MenuListview">
			<li><a href="#myCustomerPhone"><img src="images/text_icon_01.png">客服電話</a></li>
			<li data-role="list-divider"></li>
			<li><a href="#myCustomerEmail"><img src="images/text_icon_01.png">客服信箱</a></li>
			<li data-role="list-divider"></li>
		</ul>
	</div><!-- /content -->
	
	<div data-role="footer" data-theme="a" data-tap-toggle="false" data-position="fixed">
		<div id="CarouselMenu" class="CarouselMenu"><!--滑動選單-->
		</div>
	</div><!-- /footer -->
</div><!-- 選單頁 -->

<!-- ****************************** 客服電話 ***********************************-->
<div data-role="page" id="myCustomerPhone">
	<div data-role="header" data-position="fixed" class="vibo-header">
		<div class="header-padding">客服電話</div>
	</div><!-- /header -->
	
	<div data-role="content">
		<ul data-role="listview" data-inset="true" data-icon="false" data-divider-theme="d" data-theme="d">
			<li data-role="list-divider">手機直撥免費服務專線</li>
			<li><a href="tel:123" rel="external" onclick="GATrackEvent('客服電話服務', '撥打123', '');"><img src="images/phonecall.png" class="ui-li-icon ui-icon-phonecall">123(MVPN客戶請撥99123)</a></li>
			<li data-role="list-divider">365速撥語音服務</li>
			<li><a href="tel:365" rel="external" onclick="GATrackEvent('客服電話服務', '撥打365', '');"><img src="images/phonecall.png" class="ui-li-icon ui-icon-phonecall">365(MVPN客戶請撥99365)</a></li>
			<li data-role="list-divider">客服專線</li>
			<li><a href="tel:0986999123" rel="external" onclick="GATrackEvent('客服電話服務', '撥打0986999123', '');"><img src="images/phonecall.png" class="ui-li-icon ui-icon-phonecall">0986-999-123</a></li>
			<li data-role="list-divider">免費促銷專線</li>
			<li><a href="tel:0800661234" rel="external" onclick="GATrackEvent('客服電話服務', '撥打0800661234', '');"><img src="images/phonecall.png" class="ui-li-icon ui-icon-phonecall">0800-66-1234</a></li>
			<li data-role="list-divider">專人&nbsp;8:00~24:00&nbsp;掛失專線</li>
			<li><a href="tel:0277311365" rel="external" onclick="GATrackEvent('客服電話服務', '撥打0277311365', '');"><img src="images/phonecall.png" class="ui-li-icon ui-icon-phonecall">02-7731-1365</a></li>
			<li data-role="list-divider">海外服務電話</li>
			<li><a href="tel:+886277311365" rel="external" onclick="GATrackEvent('客服電話服務', '撥打+886277311365', '');"><img src="images/phonecall.png" class="ui-li-icon ui-icon-phonecall">+886-27731-1365<br><span style="color:#FF0000;white-space:normal;">漫遊期間撥打需支付國際漫遊通信費用</span></a></li>
		</ul>
	</div><!-- /content -->
	
	<div data-role="footer" data-theme="a" data-tap-toggle="false" data-position="fixed">
		<div id="CarouselMenu" class="CarouselMenu"><!--滑動選單-->
		</div>
	</div><!-- /footer -->
</div><!-- 客服電話 -->

<!-- ****************************** 客服信箱 ***********************************-->
<div data-role="page" id="myCustomerEmail">
	<div data-role="header" data-position="fixed" class="vibo-header">
		<div class="header-padding">客服信箱</div>
	</div><!-- /header -->
	
	<div data-role="content">
		<h3>親愛的客戶 您好：如您對我們提供的產品、服務內容，有任何的疑問或建議，可於網站留下您寶貴的意見。我們將儘速為您處理，謝謝！！</h3>
		<div id="divChoice" style="display:none;">
			<button onclick="setOnnetType('Y');">我是威寶用戶</button>
			<button onclick="setOnnetType('N');">我不是威寶用戶</button>
		</div>
		<div id="myForm" style="display:none;">
			<input type="hidden" id="isOnnetUser" name="isOnnetUser" value="Y">
			<table border="0">
				<tr><td colspan="2" style="font-weight:bold;">煩請填寫下列個人資料( * 號為必填欄位)</td></tr>
				<tr><td>*姓名</td><td><input type="text" data-clear-btn="false" data-mini="true" name="myName" id="myName" maxlength="10" value=""></td></tr>
				<tr><td>*手機號碼</td><td><input type="tel" data-clear-btn="false" data-mini="true" name="MSISDN" id="MSISDN" maxlength="10" value=""></td></tr>
				<tr><td>聯絡電話(日)</td><td><input type="tel" data-clear-btn="false" data-mini="true" name="ContactPhoneDay" id="ContactPhoneDay" maxlength="20" value=""></td></tr>
				<tr><td>聯絡電話(夜)</td><td><input type="tel" data-clear-btn="false" data-mini="true" name="ContactPhoneNight" id="ContactPhoneNight" maxlength="20" value=""></td></tr>
				<tr><td>*電子郵件</td><td><input type="email" data-clear-btn="false" data-mini="true" name="Email" id="Email" maxlength="100" value=""></td></tr>
				<tr><td>*回覆方式</td><td>
					<select name="ContactMethod" id="ContactMethod" data-mini="true">
						<option value="">請選擇</option>
					</select>
				</td></tr>
				<tr><td colspan="2">&nbsp;</td></tr>
				<tr><td colspan="2" style="font-weight:bold;">意見內容</td></tr>
				<tr><td>*意見類別</td><td>
					<select name="CallType1" id="CallType1" data-mini="true" onchange="updateCallType2();">
					</select>
				</td></tr>
				<tr><td>*次類別</td><td>
					<select name="CallType2" id="CallType2" data-mini="true" onchange="updateCallType3();">
					</select>
					<div id="CallType3Div" name="CallType3Div" style="display:none;">
						<select name="CallType3" id="CallType3" data-mini="true">
						</select>
					</div>
				</td></tr>
				<tr><td colspan="2">*意見描述</td></tr>
				<tr><td colspan="2"><textarea cols="40" rows="20" name="OpinionText" id="OpinionText"></textarea></td></tr>
				<tr><td colspan="2">&nbsp;&nbsp;限200個中文字之內</td></tr>
				<tr><td colspan="2">&nbsp;</td></tr>
			</table>
			<div id="divFeedbackBefore">
				是否曾反應過同樣的意見?
				<fieldset id="fsFeedbackBefore" data-role="controlgroup">
					<!--
					<label><input type="radio" name="rad0" id="rad0a">否</label>
					<label><input type="radio" name="rad0" id="rad0b">是，客服專線反應</label>
					<label><input type="radio" name="rad0" id="rad0c">是，服務信箱反應</label>
					-->
				</fieldset>
			</div>
			<button onclick="doContactUs();">確定送出</button>
		</div>
	</div><!-- /content -->
	
	<div data-role="footer" data-theme="a" data-tap-toggle="false" data-position="fixed">
		<div id="CarouselMenu" class="CarouselMenu"><!--滑動選單-->
		</div>
	</div><!-- /footer -->
</div><!-- 客服信箱 -->

</body>
</html>
<script type="text/javascript" src="js/initPage.js"></script><!--初始化頁面，設定header及footer -->

<script type="text/javascript">

	var msisdn = getLocalValue('loginmsisdn');
	var contractid = getLocalValue('logincontractid');
	var customerid = getLocalValue('logincustomerid');
	
	var callType2	= "";	//儲存所有第二層 call type 的 json

	$('#myCustomerEmail').one('pageshow', function () {	//取得各輸入欄位的內容
		var sData = "";
		sData = "Function=GetCWSOptionsNew&Request=";
		getDataFromServer("ajaxBSCAPIBridge.jsp", sData, "json", function(data){	//從 GetCWSOptions 取得選項資料
			if (data.GetCWSOptionsNewRes.ResultCode!='00000'){
				MsgBox('無法取得相關資料，請稍後再試!' + data.GetCWSOptionsNewRes.ResultText);
				return;
			}
			var s = "";
			$.each( data.GetCWSOptionsNewRes.options.ContactmethodAndPeriod, function(i, item) {	//回覆方式清單
				s += "<option value='" + item.key + "'>" + item.value + "</option>";
			});	//$.each( data.GetCWSOptionsNewRes.options.ContactmethodAndPeriod, function(i, item) {	//回覆方式清單
			if (beEmpty(s)){
				MsgBox("無法取得回覆方式清單，請稍候再重新使用本功能");
				return;
			}
			$('#myCustomerEmail #ContactMethod').append(s);

			s = "";
			$.each( data.GetCWSOptionsNewRes.options.FeedbackBefore, function(i, item) {	//是否曾反應過同樣的意見清單
				s += "<label><input type='radio' name='FeedbackBefore' id='FeedbackBefore" + item.key + "' data-mini='true' value='" + item.key + "'>" + item.value + "</label>";
			});	//$.each( data.GetCWSOptionsNewRes.options.FeedbackBefore, function(i, item) {	//是否曾反應過同樣的意見清單
			if (beEmpty(s)){
				MsgBox("無法意見反應選項清單，請稍候再重新使用本功能");
				return;
			}
			$('#myCustomerEmail #fsFeedbackBefore').append(s);
			$('#myCustomerEmail #fsFeedbackBefore').trigger('create');

			callType2 = data.GetCWSOptionsNewRes.options;	//儲存所有第二層 call type 的 json

			if (notEmpty(msisdn)){	//已登入
				updateCallType1();	//更新第一層 call type 選單的內容
				$('#myCustomerEmail #divChoice').hide();
				$('#myCustomerEmail #myForm').show();
				$('#myCustomerEmail #MSISDN').val(msisdn);
				$('#myCustomerEmail #myForm #myName').focus();
			}else{	//未登入
				/*
				$('#myCustomerEmail #divChoice').show();
				$('#myCustomerEmail #myForm').hide();
				*/
				updateCallType1();	//更新第一層 call type 選單的內容
				$('#myCustomerEmail #divChoice').hide();	//Kelly說不用分是否登入了，大家都當作已登入
				$('#myCustomerEmail #myForm').show();
				$('#myCustomerEmail #myForm #myName').focus();
			}
			
		});	//getDataFromServer("ajaxBSCAPIBridge.jsp", sData, "json", function(data){	//從 GetCWSOptions 取得選項資料
	});	//$('#myCustomerEmail').one('pageshow', function () {	//取得各輸入欄位的內容

	function updateCallType1(){	//更新第一層 call type 選單的內容
		var s = "";
		var mycallType1	= null;
		var ISVIBOUser = $('#myCustomerEmail #isOnnetUser').val();
		
		if (notEmpty(ISVIBOUser) && ISVIBOUser=="Y"){	//已登入
			mycallType1 = callType2.viboTypeL1;
		}else{	//未登入
			mycallType1 = callType2.typeL1;
		}
		$.each( mycallType1, function(i, item) {	//第一層 call type 清單
			//s += "<option value='" + item.key + "' onclick=\"updateCallType2('" + item.key + "');\">" + item.value + "</option>";
			s += "<option value='" + item.key + "'>" + item.value + "</option>";
		});	//$.each( data.GetCWSOptionsNewRes.options.viboTypeL1, function(i, item) {	//第一層 call type 清單
		if (beEmpty(s)){
			MsgBox("無法取得意見類別清單，請稍候再重新使用本功能");
			return;
		}
		$('#myCustomerEmail #CallType1').html("<option value=''>請選擇</option>" + s);
		$('#myCustomerEmail #CallType1')[0].selectedIndex = 0;
		$('#myCustomerEmail #CallType1').trigger('change');
		$('#myCustomerEmail #CallType2').html('');
	}	//function updateCallType1(){	//更新第一層 call type 選單的內容

	function updateCallType2(){	//更新第二層 call type 選單的內容
		var key = $('#myCustomerEmail #CallType1').val();
		//alert(key);
		if (beEmpty(key)){
			$('#myCustomerEmail #CallType2').html('');
			return;
		}
		var s = "";
		var mycallType2	= null;
		var ISVIBOUser = $('#myCustomerEmail #isOnnetUser').val();
		
		if (notEmpty(ISVIBOUser) && ISVIBOUser=="Y"){	//已登入
			if (key=="SP01"){	//網路收訊
				$('#myCustomerEmail #CallType3Div').show();
				mycallType2 = callType2.NetworkL2;
			}else{
				$('#myCustomerEmail #CallType3Div').hide();	//不用第三層
				mycallType2 = callType2.viboTypeL2;
			}
		}else{	//未登入
			mycallType2 = callType2.typeL2;
		}
		$.each( mycallType2, function(i, item) {	//第二層 call type 清單
			if (key=="SP01"){	//網路收訊
				s += "<option value='" + item.key + "'>" + item.value + "</option>";
			}else{
				if (item.parent==key && item.value.indexOf('紅利積點')<0 && item.value.indexOf('手機入口')<0) s += "<option value='" + item.key + "'>" + item.value + "</option>";
			}
		});	//$.each( callType2, function(i, item) {	//第二層 call type 清單
		if (beEmpty(s)){
			$('#myCustomerEmail #CallType2').html('');
			MsgBox("無法取得意見次類別清單，請選擇其他意見類別");
			return;
		}
		//alert(s);
		$('#myCustomerEmail #CallType2').html("<option value=''>請選擇</option>" + s);
		$('#myCustomerEmail #CallType2')[0].selectedIndex = 0;
		$('#myCustomerEmail #CallType2').trigger('change');
	}	//function updateCallType2(){	//更新第二層 call type 選單的內容

	function updateCallType3(){	//更新第三層 call type 選單的內容
		if ($('#myCustomerEmail #CallType1').val()!="SP01"){
			$('#myCustomerEmail #CallType3Div').hide();
			return;
		}
		$('#myCustomerEmail #CallType3Div').show();
		var key = $('#myCustomerEmail #CallType2').val();
		//alert(key);
		if (beEmpty(key)){
			$('#myCustomerEmail #CallType3').html('');
			return;
		}
		var s = "";
		var mycallType3	= null;
		mycallType3 = callType2.viboTypeL2;

		$.each( mycallType3, function(i, item) {	//第二層 call type 清單
			if (item.parent==key) s += "<option value='" + item.key + "'>" + item.value + "</option>";
		});	//$.each( callType2, function(i, item) {	//第二層 call type 清單
		if (beEmpty(s)){
			$('#myCustomerEmail #CallType3').html('');
			MsgBox("無法取得意見次類別清單，請選擇其他意見類別");
			return;
		}
		//alert(s);
		$('#myCustomerEmail #CallType3').html("<option value=''>請選擇</option>" + s);
		$('#myCustomerEmail #CallType3')[0].selectedIndex = 0;
		$('#myCustomerEmail #CallType3').trigger('change');
	}	//function updateCallType2(){	//更新第二層 call type 選單的內容
	
	function setOnnetType(type){	//設定目前未登入用戶是網內或網外
		if (type=="Y"){	//網內
			$('#myCustomerEmail #isOnnetUser').val('Y');
		}else{	//網外
			$('#myCustomerEmail #isOnnetUser').val('N');
			$('#myCustomerEmail #divFeedbackBefore').hide();
		}
		updateCallType1();	//更新第一層 call type 選單
		$('#myCustomerEmail #divChoice').hide();
		$('#myCustomerEmail #myForm').show();
		$('#myCustomerEmail #myForm #myName').focus();
	}	//function setOnnetType(type){	//設定目前未登入用戶是網內或網外

	function doContactUs(){	//新增至客服信箱
		var MSISDN = $('#myCustomerEmail #MSISDN').val();	//手機門號
		var Alias = $('#myCustomerEmail #myName').val();	//姓名
		var ContactEmail = $('#myCustomerEmail #Email').val();	//Email
		var ContactMethod = $('#myCustomerEmail #ContactMethod').val();	//回覆方式 (Email, Morning, Afternoon, Evening)

		var sCallType1 = $('#myCustomerEmail #CallType1').val();	//CALL TYPE Lv1，第一層 call type
		var sCallType2 = "";
		if (sCallType1=='SP01'){	//意見類別為網路收訊，傳給server的值是兩個次類別
			sCallType1 = $('#myCustomerEmail #CallType2').val();	//CALL TYPE Lv2，第二層 call type
			sCallType2 = $('#myCustomerEmail #CallType3').val();	//CALL TYPE Lv3，第三層 call type
		}else{	//意見類別不是網路收訊，傳給server的值是意見類別及第一個次類別
			sCallType2 = $('#myCustomerEmail #CallType2').val();	//CALL TYPE Lv2，第二層 call type
		}
		var FaultCategoryRID = sCallType1;
		var CategoryChildName = sCallType2;

		var OpinionText = $('#myCustomerEmail #OpinionText').val();	//意見內容
		var FeedbackBefore = $('#myCustomerEmail input[name="FeedbackBefore"]:radio:checked').val();	//是否曾反應過同樣的意見 (01，02，03，空白)
		var ISVIBOUser = $('#myCustomerEmail #isOnnetUser').val();	//是否為威寶用戶 (Y / N)
		var ContactPhoneDay = $('#myCustomerEmail #ContactPhoneDay').val();	//聯絡電話(日)
		var ContactPhoneNight = $('#myCustomerEmail #ContactPhoneNight').val();	//聯絡電話(夜)

		if (notEmpty(ISVIBOUser) && ISVIBOUser=="Y" && beEmpty(MSISDN)){ MsgBox('請輸入手機門號'); return; }
		if (beEmpty(Alias)){ MsgBox('請輸入姓名'); return; }
		if (beEmpty(ContactEmail)){ MsgBox('請輸入電子郵件'); return; }
		if (beEmpty(ContactMethod)){ MsgBox('請選擇回覆方式'); return; }
		if (beEmpty(FaultCategoryRID)){ MsgBox('請選擇意見類別'); return; }
		if (beEmpty(CategoryChildName)){ MsgBox('請選擇次類別'); return; }
		if (beEmpty(OpinionText)){ MsgBox('請輸入意見描述'); return; }
		if (notEmpty(ISVIBOUser) && ISVIBOUser=="Y" && beEmpty(FeedbackBefore)){ MsgBox('請選擇是否曾反應過同樣的意見'); return; }	//已登入卻未選【是否曾反應過同樣的意見】
		if (OpinionText.length>200){ MsgBox('意見描述限200字內，您目前輸入的字數為' + OpinionText.length + '個字'); return; }	//已登入卻未選【是否曾反應過同樣的意見】
		//console.log('ContactMethod=' + ContactMethod);
		//console.log('FaultCategoryRID=' + FaultCategoryRID);
		//console.log('CategoryChildName=' + CategoryChildName);
		//console.log('OpinionText=' + OpinionText.length);
		//console.log('FeedbackBefore=' + FeedbackBefore);
		var sData = "";
		sData = "Function=DoContactUS&Request=";
		if (notEmpty(MSISDN)) sData += "<MSISDN>" + MSISDN + "</MSISDN>";
		sData += "<Alias>" + Alias + "</Alias>";
		sData += "<ContactEmail>" + ContactEmail + "</ContactEmail>";
		sData += "<ContactMethod>" + ContactMethod + "</ContactMethod>";
		sData += "<FaultCategoryRID>" + FaultCategoryRID + "</FaultCategoryRID>";
		sData += "<CategoryChildName>" + CategoryChildName + "</CategoryChildName>";
		sData += "<OpinionText>" + OpinionText + "</OpinionText>";
		sData += "<ISVIBOUser>" + ISVIBOUser + "</ISVIBOUser>";
		if (notEmpty(ISVIBOUser) && ISVIBOUser=="Y") sData += "<FeedbackBefore>" + FeedbackBefore + "</FeedbackBefore>";
		sData += "<ContactPhoneDay>" + ContactPhoneDay + "</ContactPhoneDay>";
		sData += "<ContactPhoneNight>" + ContactPhoneNight + "</ContactPhoneNight>";
		//console.log(sData);
		getDataFromServer("ajaxBSCAPIBridge.jsp", sData, "xml", function(xml){	//從 GetCWSOptions 取得選項資料
			if ($(xml).find("ResultCode").text()!='00000'){
				GATrackEvent('客服信箱意見反應', '失敗', MSISDN + ':' + Alias);
				MsgBox('作業失敗：' + $(xml).find("ResultText").text());
			}else{
				if ($(xml).find("AddStatus").text()=='0'){
					GATrackEvent('客服信箱意見反應', '成功', MSISDN + ':' + Alias);
					MsgBox('<div style="text-align:left;margin-left:15px;margin-right:15px;">謝謝您留下寶貴的意見，我們將儘速為您處理，謝謝！<br>您也可以來電服務專線：0800-66-1234(9:00~22:00)，將由客服人員為您親自處理。<br>&nbsp;<br>敬祝<br>平安、快樂！</div><div style="text-align:right;margin-left:15px;margin-right:15px;">&nbsp;<br>威寶電信&nbsp;敬上</div>');
				}else{
					GATrackEvent('客服信箱意見反應', '失敗', MSISDN + ':' + Alias);
					MsgBox('作業失敗：' + $(xml).find("StatusMsg").text());
				}
			}
		});	//getDataFromServer("ajaxBSCAPIBridge.jsp", sData, "xml", function(data){	//從 GetCWSOptions 取得選項資料
	}	//function doContactUs(){	//新增至客服信箱

</script>