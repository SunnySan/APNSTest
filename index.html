<!DOCTYPE html>
<html>
	<title>MyVIBO</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

	<!--<link rel="stylesheet" href="css/jquery.mobile-1.3.2.min.css" />--><!--JQuery Mobile theme-->
	<link rel="stylesheet" href="css/jquery.mobile.structure-1.3.2.min.css" />
	<link rel="stylesheet" href="css/myvibo.min.css" /><!--將JQuery Mobile theme加上 swatch="F"-->
	<link rel="stylesheet" href="css/jquery.marquee.css" /><!-- 文字跑馬燈，請參考 http://www.givainc.com/labs/marquee_jquery_plugin.cfm -->
	<link rel="stylesheet" href="css/jquery.mobile.simpledialog.min.css" /><!--類似alert的dialog，請參考 http://dev.jtsage.com/jQM-SimpleDialog/demos2/ -->
	<link rel="stylesheet" href="css/style.css" />
	
	<script src="js/jquery-1.10.2.min.js"></script>
	<script type="text/javascript" src="js/initJQueryMobile.js"></script><!--初始化 JQuery Mobile -->
	<script src="js/jquery.mobile-1.3.2.min.js"></script>
	<script src="js/jquery.touchSwipe.min.js"></script>
	<script src="js/jquery.carouFredSel-6.2.1-packed.js"></script>
	<script src="js/jquery.marquee.min.js"></script><!-- 文字跑馬燈，請參考 http://www.givainc.com/labs/marquee_jquery_plugin.cfm -->
	<script src="js/jquery.mobile.simpledialog2.min.js"></script><!--類似alert的dialog，請參考 http://dev.jtsage.com/jQM-SimpleDialog/demos2/ -->
	<script type="text/javascript" src="js/util.js"></script>
	<script type="text/javascript" src="js/ga.js"></script><!--Browser用的Google Analytics 追蹤函數-->
	<script type="text/javascript" src="js/jquery.cookie.js"></script><!--Browser用的Cookie函數，請參考 https://github.com/carhartl/jquery-cookie -->
	<script type="text/javascript" src="js/jquery.blockUI.js"></script><!--JQuery BlockUI，請參考http://www.malsup.com/jquery/block/ -->
	
	<script src="cordova.js"></script><!--給PhoneGap用的-->
	<!--<script src="GAPlugin.js"></script>--><!--APP用的Google Analytics 追蹤函數，請參考 https://github.com/phonegap-build/GAPlugin -->
	<script type="text/javascript" src="js/initPhoneGap.js"></script><!--初始化PhoneGap-->
	
	<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
</head>


<body>

<!-- ****************************** 首頁(第一次使用APP時出現的第一張圖) ***********************************-->
<div data-role="page" id="home-slide1">
	<div data-role="content" style="border:0px !important;padding:0px !important;margin:0px !important;overflow:hidden !important;">
		<div id="slide1" name="slide1" class="home-slide" style="background-image: url(images/home_slide1.jpg);">
			<div style="float:right;width:50%;height:100%;" onclick="swipeToLeft();"></div>
		</div>
	</div><!-- /content -->
</div><!-- (第一次使用APP時出現的第一張圖) -->

<!-- ****************************** 首頁(第一次使用APP時出現的第二張圖) ***********************************-->
<div data-role="page" id="home-slide2">
	<div data-role="content" style="border:0px !important;padding:0px !important;margin:0px !important;overflow:hidden !important;">
		<div id="slide2" name="slide2" class="home-slide" style="background-image: url(images/home_slide2.jpg);">
			<div style="float:left;width:50%;height:100%;" onclick="swipeToRight();"></div>
			<div style="float:right;width:50%;height:100%;" onclick="swipeToLeft();"></div>
		</div>
	</div><!-- /content -->
</div><!-- (第一次使用APP時出現的第二張圖) -->

<!-- ****************************** 首頁(第一次使用APP時出現的第三張圖) ***********************************-->
<div data-role="page" id="home-slide3">
	<div data-role="content" style="border:0px !important;padding:0px !important;margin:0px !important;overflow:hidden !important;">
		<div id="slide3" name="slide3" class="home-slide" style="background-image: url(images/home_slide3.jpg);">
			<div style="float:left;width:50%;height:100%;" onclick="swipeToRight();"></div>
			<div style="float:right;width:50%;height:100%;" onclick="swipeToLeft();"></div>
		</div>
	</div><!-- /content -->
</div><!-- (第一次使用APP時出現的第三張圖) -->

<!-- ****************************** 設定登入方式 ***********************************-->
<div data-role="page" id="AutoLogin" data-position="fixed">
	<div data-role="header" class="vibo-header-home">
		<div class="header-padding"></div>
	</div><!-- /header -->
	
	<div data-role="content">
		<form>
			<fieldset data-role="controlgroup">
				<legend>選擇登入方式</legend>
				<input type="radio" name="rdo1" id="rdo1a" value="A">
				<label for="rdo1a">自動登入<br>首次登入時輸入門號/密碼，之後即由系統自動登入</label>
				<input type="radio" name="rdo1" id="rdo1b" value="M">
				<label for="rdo1b">手動登入<br>登入時需輸入門號/密碼</label>
				<input type="radio" name="rdo1" id="rdo1c" value="N">
				<label for="rdo1c">我目前不是台灣之星月租型用戶</label>
			</fieldset>
		</form>
		<input type="button" value="確定" onclick="SetAutoLogin();">
	</div><!-- /content -->
	
	<div data-role="footer" data-tap-toggle="false" data-position="fixed">
		<div class="footer-copyright">
			威寶電信版權所有 Copyright© 2013 All Rights Reserved.
		</div>
	</div><!-- /footer -->
</div><!-- 設定登入方式 -->

<!-- ****************************** 首頁 ***********************************-->
<div data-role="page" id="home">
	<div data-role="header" data-position="fixed" class="vibo-header-home" style="top:0px!important;position:fixed;">
		<div class="header-padding"></div>
		<a id="homeLogin" href="#userLogin" class="ui-btn-right" data-icon="star" data-theme="g">登入</a>
	</div><!-- /header -->
	
	<div data-role="content" style="border:0px !important;padding:0px !important;margin:0px !important;overflow:hidden !important;background-color:#FFFFFF!important;background-image:none!important;">
		<div class="ui-grid-a">
			<div id="marqueeimg" name="marqueeimg" class="ui-block-a" style="width:50px;height:30px;"><img src="images/news.png" style="width:100%;height:100%;"></div>
			<div id="marqueediv" name="marqueediv" class="ui-block-b style="width:100%!important;border:0!important;">
				<ul id="marquee" class="marquee" onclick="location.href='myRecommand.html';" style="width:100%;border-top-width:2px;border-right-width:0px;border-bottom-width:5px;border-left-width:0px;border-top-color:#C6C3C3;border-bottom-color:#C6C3C3;background-color:#FFFFFF;">
					<li>歡迎使用台灣之星行動客服APP.</li>
					<li>請點選這裡觀看優惠訊息.</li>
				</ul>
			</div>
		</div>

		<div id="grid-container" name="grid-container" class="ui-grid-b">
			<div class="ui-block-a grid-top grid-left">		<a id="agrid1" name="agrid1" href="#" rel="external" onclick="gridClick(1);"><image id="grid1" name="grid1" src="images/grid-1-1.png" /></a></div>
			<div class="ui-block-b grid-top grid-center">	<a id="agrid2" name="agrid2" href="#" rel="external" onclick="gridClick(2);"><image id="grid2" name="grid2" src="images/grid-2-1.png" /></a></div>
			<div class="ui-block-c grid-top grid-right">	<a id="agrid3" name="agrid3" href="#" rel="external" onclick="gridClick(3);"><image id="grid3" name="grid3" src="images/grid-3-1.png" /></a></div>
			<div class="ui-block-a grid-middle grid-left">	<a id="agrid4" name="agrid4" href="#" rel="external" onclick="gridClick(4);"><image id="grid4" name="grid4" src="images/grid-4-1.png" /></a></div>
			<div class="ui-block-b grid-middle grid-center"><a href="myWifi.html" rel="external" onclick="gridClick(5);"><image id="grid5" name="grid5" src="images/grid-5-1.png" /></a></div>
			<div class="ui-block-c grid-middle grid-right">	<a href="myQuery.html" rel="external" onclick="gridClick(6);"><image id="grid6" name="grid6" src="images/grid-6-1.png" /></a></div>
			<div class="ui-block-a grid-bottom grid-left">	<a href="myQuery.html" rel="external" onclick="gridClick(7);"><image id="grid7" name="grid7" src="images/grid-7-1.png" /></a></div>
			<div class="ui-block-b grid-bottom grid-center"><a href="mySettings.html" rel="external" onclick="gridClick(8);"><image id="grid8" name="grid8" src="images/grid-8-1.png" /></a></div>
			<div class="ui-block-c grid-bottom grid-right">	<a href="myCustomer.html" rel="external" onclick="gridClick(9);"><image id="grid9" name="grid9" src="images/grid-9-1.png" /></a></div>
		</div>

		<div id='CarouselPromotion' style="width:100%;" class="HomeCarouselMenu"><!--首頁促銷訊息-->
			<img src='images/defaultHomeBanner.jpg' />
		</div><!--首頁促銷訊息-->
	</div><!-- /content -->
	<!--
	<div data-role="footer" data-tap-toggle="false" data-position="fixed" style="border:0px !important;padding:0px !important;margin:0px !important;bottom:0px !important;position:fixed;">
		<div class="footer-copyright">
			威寶電信版權所有 Copyright© 2013 All Rights Reserved.
		</div>
	</div>
	-->
	<!-- /footer -->
</div><!-- 首頁 -->

<!-- ****************************** 用戶登入 ***********************************-->
<div data-role="page" id="userLogin" data-position="fixed">
	<div data-role="header" class="vibo-header-home">
		<div class="header-padding"></div>
		<a href="#home" class="ui-btn-right" data-icon="home" data-theme="g">首頁</a>
	</div><!-- /header -->
	
	<div data-role="content">
		<h3 class="PageTitle">用戶登入</h3>
		<form id="frmUserLogin">
			<label for="txtLoginMSISDN">威寶電信門號</label>
			<input type="tel" name="txtLoginMSISDN" id="txtLoginMSISDN" minlength="10" maxlength="10" value="">
			<label for="txtLoginPassword">密碼(同威寶官網用戶登入密碼)</label>
			<input type="password" name="txtLoginPassword" id="txtLoginPassword" value="">
				<table style="width:100%;">
					<tr>
						<td>記住門號</td>
						<td style="float:right;">
							<select name="flipRememberMe" id="flipRememberMe" data-role="slider" data-mini="true">
								<option value="off">關閉</option>
								<option value="on">開啟</option>
							</select>
						</td>
					</tr>
				</table>

			<!--
			<div data-role="fieldcontain">
				<label for="flipRememberMe">記住門號</label>
				<select name="flipRememberMe" id="flipRememberMe" data-role="slider" data-mini="true">
					<option value="off">關閉</option>
					<option value="on">開啟</option>
				</select>
			</div>
			-->
			<!--
			<label>
				<input type="checkbox" id="chkRememberMe" name="chkRememberMe">記住門號
			</label>
			-->
			<div data-role="controlgroup" data-type="horizontal">
			    <a href="#" data-role="button" onclick="doUserLogin();return false;">登入</a>
			    <a href="#" data-role="button" onclick="doCancelLogin();return false;">取消</a>
			</div>
			<ul data-role="listview" data-inset="true" data-content-theme="d">
				<li><a href="#userLoginForgetPassword">申請密碼/忘記密碼</a></li>
				<!--<li><a href="#userLoginChangePassword">變更密碼</a></li>-->
				<li><a href="#userLoginGuide">登入說明</a></li>
			</ul>
		</form>
	</div><!-- /content -->
	
	<div data-role="footer" data-tap-toggle="false" data-position="fixed">
		<div class="footer-copyright">
			威寶電信版權所有 Copyright© 2013 All Rights Reserved.
		</div>
	</div><!-- /footer -->
</div><!-- 用戶登入 -->

<!-- ****************************** 申請密碼/忘記密碼 ***********************************-->
<div data-role="page" id="userLoginForgetPassword" data-position="fixed">
	<div data-role="header" class="vibo-header-home">
		<div class="header-padding"></div>
		    <a href='#' data-role='button' data-rel='back' data-icon='back' data-theme="g" class="ui-btn-right">上頁</a>
	</div><!-- /header -->
	
	<div data-role="content">
		<h3 class="PageTitle">申請密碼/忘記密碼</h3>
		<form id="frmForgetPassword">
			<label for="txtForgetPasswordMSISDN">威寶電信門號</label>
			<input type="tel" name="txtForgetPasswordMSISDN" id="txtForgetPasswordMSISDN" value="">
			<label for="txtForgetPasswordCustomerId">身分證號/統一編號</label>
			<input type="text" name="txtForgetPasswordCustomerId" id="txtForgetPasswordCustomerId" value="">
		    <a href="#" data-role="button" onclick="doForgetPassword();return false;">申請密碼</a>
		</form>

	</div><!-- /content -->
	
	<div data-role="footer" data-tap-toggle="false" data-position="fixed">
		<div class="footer-copyright">
			威寶電信版權所有 Copyright© 2013 All Rights Reserved.
		</div>
	</div><!-- /footer -->
</div><!-- 申請密碼/忘記密碼 -->

<!-- ****************************** 變更密碼 ***********************************-->
<div data-role="page" id="userLoginChangePassword" data-position="fixed">
	<div data-role="header" class="vibo-header-home">
		<div class="header-padding"></div>
		<div data-role='controlgroup' data-type='horizontal' class='ui-btn-right'>
		    <a href='#' data-role='button' data-rel='back' data-icon='back' data-theme="g">上頁</a>
		    <a href='#home' data-role='button' data-icon='home' data-theme="g">首頁</a>
		</div>
	</div><!-- /header -->
	
	<div data-role="content">
		<form id="frmChangePassword">
			<label for="txtChangePasswordMSISDN">威寶電信門號</label>
			<input type="text" name="txtChangePasswordMSISDN" id="txtChangePasswordMSISDN" value="">
			<label for="txtChangePasswordOldPassword">舊密碼</label>
			<input type="password" name="txtChangePasswordOldPassword" id="txtChangePasswordOldPassword" value="">
			<label for="txtChangePasswordNewPassword1">新密碼</label>
			<input type="password" name="txtChangePasswordNewPassword1" id="txtChangePasswordNewPassword1" value="">
			<label for="txtChangePasswordNewPassword2">請再輸入一次新密碼</label>
			<input type="password" name="txtChangePasswordNewPassword2" id="txtChangePasswordNewPassword2" value="">
		    <a href="#" data-role="button" onclick="doChangePassword();return false;">變更密碼</a>
		</form>

	</div><!-- /content -->
	
	<div data-role="footer" data-tap-toggle="false" data-position="fixed">
		<div class="footer-copyright">
			威寶電信版權所有 Copyright© 2013 All Rights Reserved.
		</div>
	</div><!-- /footer -->
</div><!-- 變更密碼 -->

<!-- ****************************** 用戶登出 ***********************************-->
<div data-role="page" id="userLogout" data-position="fixed">
	<div data-role="header" class="vibo-header-home">
		<div class="header-padding"></div>
		<a href="#home" class="ui-btn-right" data-icon="home" data-theme="g">首頁</a>
	</div><!-- /header -->
	
	<div data-role="content">
		<h3 class="PageTitle">用戶登出</h3>
		<label for="text-1">確定登出？</label>
		<div data-role="controlgroup" data-type="horizontal">
		    <a href="#" data-role="button" onclick="doUserLogout();return false;">確定</a>
		    <a href="#home" data-role="button">取消</a>
		</div>
		
	</div><!-- /content -->
	
	<div data-role="footer" data-tap-toggle="false" data-position="fixed">
		<div class="footer-copyright">
			威寶電信版權所有 Copyright© 2013 All Rights Reserved.
		</div>
	</div><!-- /footer -->
</div><!-- 用戶登出 -->

<!-- ****************************** 登入說明 ***********************************-->
<div data-role="page" id="userLoginGuide" data-position="fixed">
	<div data-role="header" class="vibo-header-home">
		<div class="header-padding"></div>
		<div data-role='controlgroup' data-type='horizontal' class='ui-btn-right'>
		    <a href='#' data-role='button' data-rel='back' data-icon='back' data-theme="g">上頁</a>
		    <a href='#home' data-role='button' data-icon='home' data-theme="g">首頁</a>
		</div>
	</div><!-- /header -->
	
	<div data-role="content">
		<h3 style="color:#0080FF;text-align:left;">用戶登入</h3>
		歡迎使用威寶電信網站各項功能及服務，用戶請輸入門號與密碼。(同威寶官網用戶登入密碼)。
		
		<h3 style="color:#0080FF;text-align:left;">申請密碼</h3>
		歡迎您加入威寶電信，申請密碼請先輸入門號及身分證字號或統一編號，按下送出後，我們立即會將您的密碼以簡訊方式通知您，請以此密碼登入即可享受威寶電信網站各項功能及服務。
		
		<h3 style="color:#0080FF;text-align:left;">忘記密碼</h3>
		請輸入您的手機號碼與身分證字號或統一編號，按下送出後，我們立即會將您的密碼以簡訊方式通知您，請以此密碼登入即可享受威寶電信網站各項功能及服務。
		
		<h3 style="color:#0080FF;text-align:left;">變更密碼</h3>
		歡迎使用威寶電信網站各項功能及服務，您可自行設定密碼，密碼需為4~6個數字組合。

	</div><!-- /content -->
	
	<div data-role="footer" data-tap-toggle="false" data-position="fixed">
		<div class="footer-copyright">
			威寶電信版權所有 Copyright© 2013 All Rights Reserved.
		</div>
	</div><!-- /footer -->
</div><!-- 登入說明 -->

</body>
</html>

<script type="text/javascript">
	
	$('#home-slide1').one('pageshow',function(event){
		if (notEmpty(getLocalValue('home-slide'))){	//已顯示過 slide，看要不要直接進入首頁
			if (beEmpty(getLocalValue('AutoLogin'))){
				$.mobile.changePage('#AutoLogin',{transition: 'pop'});
			}else{
				$.mobile.changePage('#home',{transition: 'pop'});
			}
			return;
		}	//if (notEmpty(getLocalValue('home-slide'))){	//已顯示過 slide，看要不要直接進入首頁
		$('.home-slide').width($(window).width());
		$('.home-slide').height($(window).height());
		$('.home-slide').swipe( { swipeLeft:swipeToLeft, swipeRight:swipeToRight, allowPageScroll:"horizontal"} );	//首頁(第一次使用APP時出現的圖滑動效果)
	});
	
	function swipeToLeft(){	//首頁(第一次使用APP時出現的圖從右往左滑)
		var pid = $.mobile.activePage.attr('id');
		if (pid=="home-slide1"){
			$.mobile.changePage('#home-slide2',{transition: 'slide', reverse: false});
			return;
		}
		if (pid=="home-slide2"){
			$.mobile.changePage('#home-slide3',{transition: 'slide', reverse: false});
			return;
		}
		if (pid=="home-slide3"){
			setLocalValue('home-slide', 'Y');	//以後就不顯示slide頁面了
			$.mobile.changePage('#AutoLogin',{transition: 'pop'});
			//$.mobile.changePage('#home',{transition: 'slide', reverse: false});
			return;
		}
	}	//function swipeToLeft(){	//首頁(第一次使用APP時出現的圖從右往左滑)
	
	function swipeToRight(){	//首頁(第一次使用APP時出現的圖從左往右滑)
		var pid = $.mobile.activePage.attr('id');
		if (pid=="home-slide2"){
			$.mobile.changePage('#home-slide1',{transition: 'slide', reverse: true});
			return;
		}
		if (pid=="home-slide3"){
			$.mobile.changePage('#home-slide2',{transition: 'slide', reverse: true});
			return;
		}
	}	//function swipeToRight(){	//首頁(第一次使用APP時出現的圖從左往右滑)
	
	$('#home').one('pageshow',function(event){
		//$('#home #marquee').marquee({pauseSpeed: 1000});

		var MainHeight = $(window).height()-$("#home div[data-role='header']").outerHeight(true)-$("#home div[data-role='footer']").outerHeight(true);	//全螢幕扣掉 header & footer 的高度
		var CarouselPromotionHeight = $(window).width()*75/480;	//首頁促銷訊息跑馬燈的高度，以螢幕寬度的30/72計算，若螢幕寬度為480，則跑馬燈高度為75
		var IconHeight = (MainHeight-CarouselPromotionHeight - $('#home #marquee').outerHeight(true))/4;	//剩餘畫面1/3高度做為每個 map icon的高
		var Margin		= $(window).width()/15;

		CarouselPromotionHeight	= Math.ceil(CarouselPromotionHeight);	//無條件進位，取大於這個數的最小整數
		IconHeight				= Math.ceil(IconHeight);				//無條件進位，取大於這個數的最小整數

		$('#home #CarouselPromotion').height(CarouselPromotionHeight);
		$('#home #grid-container').height(IconHeight*4);
		$('#home .grid-top').css('margin-top', Margin);
		$('#home .grid-top').css('margin-bottom', Margin);
		$('#home .grid-center').css('margin-left', Margin);
		$('#home .grid-center').css('margin-right', Margin);
		$('#home .grid-left').css('margin-left', Margin);
		$('#home .grid-right').css('margin-right', Margin);
		$('#home .grid-bottom').css('margin-top', Margin);
		$('#home .grid-bottom').css('margin-bottom', Margin);
		$('#home #grid-container div').width(($(window).width() - Margin*4)/3);
		$('#home #grid-container div').height((MainHeight - CarouselPromotionHeight - $('#home #marquee').outerHeight(true) - Margin*4)/3);
		$('#home #grid-container div img').width('100%');
		$('#home #grid-container div img').height('100%');
		$("#home div[data-role='content']").height(MainHeight);
		
		$('#home #marqueeimg').height($('#home #marqueediv').outerHeight(true));
		$('#home #marqueediv').width($(window).width()-50);	//跑馬燈的寬度，螢幕寬度減掉左方圖片寬度

		//取得PushMessage(訊息提醒)
		getPushMessage();
		//取得首頁促銷訊息
		var sData = "";
		sData = "type=HomeBanner";
		getDataFromServer("ajaxGetPromotionMessageList.jsp", sData, "json", GetPromotionMessageList_Success, false);
	});

	function gridClick(i){
		if (!isLogin() && i<5) return false;	//若未登入且點選需登入的項目，則不做事
		$('#grid' + i).attr('src', 'images/grid-' + i + '-2.png');
	}
	
	$('#userLogin').one('pageshow',function(event){
		GATrackPageView('用戶登入');
	});
	
	$('#userLoginForgetPassword').one('pageshow',function(event){
		GATrackPageView('申請密碼');
	});

	$('#userLogout').one('pageshow',function(event){
		GATrackPageView('用戶登出');
	});

	$('#home').on('pageshow',function(event){
		checkLoginStatus();
		$("#home div[data-role='footer']").show();
	});
	

	$('#userLogin').on('pageshow',function(event){
		var localmsisdn = getLocalValue('msisdn');
		var localpassword = getLocalValue('password');
		var localAutoLogin = getLocalValue('AutoLogin');
		if (beEmpty(localmsisdn)) localmsisdn = '';
		if (beEmpty(localpassword)) localpassword = '';
		if (notEmpty(localAutoLogin) && localAutoLogin=="Y"){
			$('#frmUserLogin #txtLoginMSISDN').val(localmsisdn);
			$('#frmUserLogin #txtLoginPassword').val(localpassword);	//只記門號不記密碼
			$('#frmUserLogin #flipRememberMe').val('on').slider('refresh');
		}else{
			$('#frmUserLogin #txtLoginMSISDN').val('');
			$('#frmUserLogin #txtLoginPassword').val('');	//只記門號不記密碼
			$('#frmUserLogin #flipRememberMe').val('off').slider('refresh');
		}
		//$('#frmUserLogin #txtLoginPassword').val('');	//只記門號不記密碼
	});

</script>

<script type="text/javascript">
	//var gMSISDN		= "";

	function SetAutoLogin(){	//設定自動登入方式
		var s = $("#AutoLogin input[name='rdo1']:radio:checked").val();
		if (beEmpty(s)){
			MsgBox("請選擇登入方式");
			return;
		}
		var a = "";
		if (s=="A") a = "Y";	//自動登入
		if (s=="M") a = "N";	//手動登入
		if (s=="N") a = "";		//我目前不是台灣之星月租型用戶
		setLocalValue('AutoLogin', a);
		if (beEmpty(a)){
			showPage('#home');
		}else{
			showPage('#userLogin');
		}
	}	//function SetAutoLogin(){	//設定自動登入方式

	//檢查登入狀態
	function checkLoginStatus(){
		var i = 0;
		if (beEmpty(getLocalValue('loginmsisdn'))){	//未登入
			$('#home #homeLogin .ui-btn-text').text('登入');
			$('#home #homeLogin').attr('href', '#userLogin');
			$('#home #main-bg').attr('src', 'images/main-bg-disable.png');	//換為四個項目是灰色的底圖
			for (i=1;i<5;i++){
				$('#home #grid' + i).attr('src', 'images/grid-' + i + '-3.png');
				$('#home #agrid' + i).attr('href', '#');	//取消四個項目的連結
			}
			//for (i=1;i<5;i++) $('#home #home-text' + i).css('color', '#777777');	//把四個項目的文字變淡
		}else{
			userAuthentication();	//檢查登入資訊是否正確
			$('#home #homeLogin .ui-btn-text').text('登出');
			$('#home #homeLogin').attr('href', '#userLogout');
			for (i=1;i<5;i++){
				$('#home #grid' + i).attr('src', 'images/grid-' + i + '-1.png');
			}
			$('#home #agrid1').attr('href', 'myBill.html');
			$('#home #agrid2').attr('href', 'myPay.html');
			$('#home #agrid3').attr('href', 'myPlan.html');
			$('#home #agrid4').attr('href', 'myService.html');
			//for (i=1;i<5;i++) $('#home #home-text' + i).css('color', '#222222');
		}
	}	//function checkLoginStatus(){
	
	//用戶登入
	function doUserLogin(){
		var msisdn		= $('#frmUserLogin #txtLoginMSISDN').val();
		var password	= $('#frmUserLogin #txtLoginPassword').val();
		if (beEmpty(msisdn) || beEmpty(password)){
			MsgBox('請輸入門號及密碼!');
			return;
		}
		var sData = "";
		sData = "Function=DoAuthCheck&Request=";
		sData += "<MSISDN>" + msisdn + "</MSISDN>";
		sData += "<Password>" + password + "</Password>";
		getDataFromServer("ajaxBSCAPIBridge.jsp", sData, "xml", doUserLogin_Success);
	}	//function doUserLogin(){
	
	function doUserLogin_Success(xml){
		var ResultCode = $(xml).find("ResultCode").text();
		var ResultText = $(xml).find("ResultText").text();
		if (ResultCode!='00000'){	//作業失敗
			if (ResultCode=='99002'){	//本APP已終止服務，請至Google Play或App Store下載新的APP!
				GATrackEvent('本APP已終止服務', $('#frmUserLogin #txtLoginMSISDN').val(), '');
				MsgBox(ResultText);
				return;
			}else{
				GATrackEvent('用戶登入失敗', $('#frmUserLogin #txtLoginMSISDN').val(), '');
				//MsgBox('登入失敗：' + ResultText);
				MsgBox('登入失敗');
				return;
			}
		}	//if (ResultCode=='00000'){	//作業成功

		var msisdn		= $('#frmUserLogin #txtLoginMSISDN').val();
		var password	= $('#frmUserLogin #txtLoginPassword').val();
		var contractid = $(xml).find("ContractId").text();
		var customerid = $(xml).find("CustomerId").text();

		setLocalValue('loginmsisdn', msisdn);			//將門號存起來
		setLocalValue('logincontractid', contractid);	//將ContractId存起來
		setLocalValue('logincustomerid', customerid);	//將CustomerId存起來
		setLocalValue('loginpassword', password);	//將Password存起來

		doPushMessageRegister(msisdn, contractid);	//檢查是否有註冊GCM/APNS Push Message，若未註冊則進行註冊
		
		//if ($('#frmUserLogin #chkRememberMe').is(':checked')){	//記住門號
		if ($('#frmUserLogin #flipRememberMe').val()=="on"){	//記住門號
			setLocalValue('msisdn', msisdn);
			setLocalValue('password', password);	//只記門號不記密碼
			setLocalValue('AutoLogin', 'Y');
		}else{
			setLocalValue('msisdn', '');
			setLocalValue('password', '');
			setLocalValue('AutoLogin', 'N');
		}
		GATrackEvent('用戶登入成功', msisdn,  contractid);
		//MsgBox('您已成功登入!', function(){showPage('#home');});
	}

	//用戶登出
	function doUserLogout(){
		GATrackEvent('用戶登出', '成功', getLocalValue('loginmsisdn') + ':' + getLocalValue('logincontractid'));
		clearLoginInfo();	//清除登入資料
		MsgBox('您已登出!', function(){showPage('#home');});
	}	//function doUserLogout(){
	
	//用戶取消登入
	function doCancelLogin(){
		if (!isRunInApp() || getPlatformName()=="iOS"){	//執行在手機瀏覽器或iOS作業系統，不顯示【離開】按鍵
			$('<div>').simpledialog2({
				mode: 'button',
				headerText: '取消登入通知',
				headerClose: false,
				themeDialog: 'f',
				buttonPrompt: '此功能僅適威寶用戶門號，請按<繼續使用>後使用部分功能',
				buttons : {
					'繼續使用': {
						click: function () { 
							showPage("#home");
						}
					}
				}
			});
		}else{
			$('<div>').simpledialog2({
				mode: 'button',
				headerText: '取消登入通知',
				headerClose: false,
				themeDialog: 'f',
				buttonPrompt: '此功能僅適威寶用戶門號，若您不再使用請按<離開>，或繼續使用此部分功能',
				buttons : {
					'離開': {
						click: function () { 
							if (isRunInApp()) navigator.app.exitApp(); else window.close();
						},
	        			icon: "delete"
					},
					'繼續使用': {
						click: function () { 
							showPage("#home");
						}
					}
				}
			});
		}	//if (!isRunInApp() || getPlatformName()=="iOS"){	//執行在手機瀏覽器或iOS作業系統，不顯示【離開】按鍵
	}	//function doCancelLogin(){

	function getPushMessage(){	//準備取得PushMessage(訊息提醒)
		//var txtCurrDate = getCurrentDate();	//今天日期，格式為：2013/10/3
		//var txtLastPushMessageDate = getLocalValue('PushMessage');	//上次擷取訊息的時間

		//if (!isLogin()) return;	//未登入的使用者不需推播
		
		//if (txtLastPushMessageDate!=txtCurrDate){	//從上次擷取訊息至今已超過一天，重新抓資料
			var sData = "type=PushMessage";
			getDataFromServer("ajaxGetPromotionMessageList.jsp", sData, "json", GetPushMessage_Success, false);
		//}
	}	//function getPushMessage(){	//取得PushMessage(訊息提醒)

	function GetPushMessage_Success(data){	//取得PushMessage(訊息提醒)
		var ResultCode = data.ResultCode;
		var ResultText = data.ResultText;
		if (ResultCode!='00000'){	//作業失敗
			//$('#CarouselPromotion').html('');	//不用把html清除，顯示預設圖檔
			$('#home #marquee').marquee({yScroll: "bottom", pauseSpeed: 2000});	//顯示預設跑馬燈
			return;
		}	//if (ResultCode=='00000'){	//作業成功
		//有資料，開始產生頁面內容
		var s = "";
		var j = 0;

		$.each( data.ResultData.items, function(i, item) {	//每個訊息項目
			s += "<li>" + item.Subject + "</li>";
			j++;
		});	//$.each( data.ResultData.items, function(i, item) {	//每個訊息項目
		if (j<2){
			$('#home #marquee').append(s);
		}else{
			$('#home #marquee').html(s);
		}

		if (notEmpty(s)){
			$('#home #marquee').marquee({yScroll: "bottom", pauseSpeed: 2000});
			//setLocalValue('PushMessage', getCurrentDate());	//將今天日期紀錄起來
		}
	}	//function GetPushMessage_Success(data){	//取得PushMessage(訊息提醒)

	function GetPromotionMessageList_Success(data){	//取得首頁促銷訊息
		var ResultCode = data.ResultCode;
		var ResultText = data.ResultText;
		if (ResultCode!='00000'){	//作業失敗
			//$('#CarouselPromotion').html('');	//不用把html清除，顯示預設圖檔
			return;
		}	//if (ResultCode=='00000'){	//作業成功
		//有資料，開始產生跑馬燈		
		var s = "";
		$.each( data.ResultData.items, function(i, item) {	//每個訊息項目
			if (notEmpty(item.LinkURL)){
				s += "<a href='" + item.LinkURL + "' class='external' target='_blank' data-rel='dialog'><div style='background-image:url(" + item.SubjectPic + ");'><span>&nbsp;</span></div></a>";
			}else{
				if (item.ShowNewEvent=='Y'){	//最新活動
					s += "<a href='myRecommand.html?p=RecommandNewEvent&mid=" + item.MessageId + "' rel='external'><div style='background-image:url(" + item.SubjectPic + ");'><span>&nbsp;</span></div></a>";
				}else if (item.ShowProgram=='Y'){	//優惠方案
					s += "<a href='myRecommand.html?p=RecommandProgram&mid=" + item.MessageId + "' rel='external'><div style='background-image:url(" + item.SubjectPic + ");'><span>&nbsp;</span></div></a>";
				}
			}
		});	//$.each( data.ResultData.items, function(i, item) {	//每個訊息項目

		if (notEmpty(s)){
			var CarouselPromotionHeight = $(window).width()*75/480;	//首頁促銷訊息跑馬燈的高度，以螢幕寬度的75/480計算，若螢幕寬度為480，則跑馬燈高度為75
			var CarouselPromotionWidth = $(window).width();	//首頁促銷訊息跑馬燈的寬度
			$('#home #CarouselPromotion').html("<div id='CarouselPromotionItems'>" + s + "</div><div style='float:none;clear:both;'></div>");
			$('#home #CarouselPromotion #CarouselPromotionItems').css('width', CarouselPromotionWidth);
			$('#home #CarouselPromotion #CarouselPromotionItems div').css('width', CarouselPromotionWidth);
			$('#home #CarouselPromotion #CarouselPromotionItems img').css('width', CarouselPromotionWidth);
			$('#home #CarouselPromotion #CarouselPromotionItems').css('height', CarouselPromotionHeight);
			$('#home #CarouselPromotion #CarouselPromotionItems div').css('height', CarouselPromotionHeight);
			$('#home #CarouselPromotion #CarouselPromotionItems img').css('height', CarouselPromotionHeight);
			$('#home #CarouselPromotion #CarouselPromotionItems').carouFredSel({
				items: {
					visible: 1,
					start: 0
				},
				responsive: false,
				auto: {
					duration    : 1000,
					timeoutDuration: 4000,
					pauseOnHover: true
				},
				padding: [0, 0, 0, 0],
				scroll: {
					items: 1,
					duration: 500
				},
				swipe: {
					onMouse: true,
					onTouch: true
				}
			});
			$('#home').on({ 'swipeleft' : function(e){ e.preventDefault(); } });
			$('#home').on({ 'swiperight' : function(e){ e.preventDefault(); } });
		}
	}	//function GetPromotionMessageList_Success(xml){	//取得首頁促銷訊息

	//若<a> 中有 "class=external"，點取連結時連到OS的 browser
	$(document).on('click', ".external", function (e) {
		if (isRunInApp()){
			e.preventDefault();
			var targetURL = $(this).attr("href");
			var ref = window.open(targetURL, "_system");
		}
	});

	//申請密碼
	function doForgetPassword(){
		var msisdn		= $('#frmForgetPassword #txtForgetPasswordMSISDN').val();
		var customerid	= $('#frmForgetPassword #txtForgetPasswordCustomerId').val().toUpperCase();

		if (beEmpty(msisdn) || beEmpty(customerid)){
			MsgBox('請輸入門號及證號!');
			return;
		}
		var sData = "";
		sData = "Function=DoForgetPwd&Request=";
		sData += "<MSISDN>" + msisdn + "</MSISDN>";
		sData += "<CustomerId>" + customerid + "</CustomerId>";
		getDataFromServer("ajaxBSCAPIBridge.jsp", sData, "xml", function(xml){
			var ResultCode = $(xml).find("ResultCode").text();
			var ResultText = $(xml).find("ResultText").text();
			if (ResultCode!='00000'){	//作業失敗
				MsgBox('作業失敗：' + ResultText);
				return;
			}	//if (ResultCode=='00000'){	//作業成功
			if ($(xml).find("Status").text()=='0'){
				MsgBox('作業完成：' + $(xml).find("StatusMsg").text());
				GATrackEvent('申請密碼', '成功', msisdn);
				$('#userLoginForgetPassword #txtForgetPasswordMSISDN').val('');
				$('#userLoginForgetPassword #txtForgetPasswordCustomerId').val('');
			}else{
				MsgBox('作業失敗：' + $(xml).find("StatusMsg").text());
				GATrackEvent('申請密碼', '失敗', msisdn);
			}
		});
	}	//function doForgetPassword(){
	
	//變更密碼
	function doChangePassword(){
		var msisdn			= $('#frmChangePassword #txtChangePasswordMSISDN').val();
		var oldpassword		= $('#frmChangePassword #txtChangePasswordOldPassword').val();
		var newpassword1	= $('#frmChangePassword #txtChangePasswordNewPassword1').val();
		var newpassword2	= $('#frmChangePassword #txtChangePasswordNewPassword2').val();
		
		if (beEmpty(msisdn) || beEmpty(oldpassword) || beEmpty(newpassword1) || beEmpty(newpassword2)){
			MsgBox('請輸入所有欄位!');
			return;
		}

		if (newpassword1!=newpassword2){
			MsgBox('兩個新密碼的值不相同!');
			return;
		}

		if (newpassword1.length<4 || newpassword1.length>6){
			MsgBox('密碼長度需為4~6碼!');
			return;
		}

		var sData = "";
		sData = "Function=DoPwdChange&Request=";
		sData += "<MSISDN>" + msisdn + "</MSISDN>";
		sData += "<OldPassword>" + oldpassword + "</OldPassword>";
		sData += "<NewPassword>" + newpassword1 + "</NewPassword>";
		getDataFromServer("ajaxBSCAPIBridge.jsp", sData, "xml", function(xml){
			var ResultCode = $(xml).find("ResultCode").text();
			var ResultText = $(xml).find("ResultText").text();
			if (ResultCode!='00000'){	//作業失敗
				MsgBox('作業失敗：' + ResultText);
				return;
			}	//if (ResultCode=='00000'){	//作業成功
			if ($(xml).find("Status").text()=='0'){
				MsgBox('作業完成：' + $(xml).find("StatusMsg").text());
				GATrackEvent('變更密碼', '成功', msisdn);
			}else{
				MsgBox('作業失敗：' + $(xml).find("StatusMsg").text());
				GATrackEvent('變更密碼', '失敗', msisdn);
			}
		});
	}	//function doChangePassword(){

	function doPushMessageRegister(msisdn, contractid){	//檢查是否有註冊GCM/APNS Push Message，若未註冊則進行註冊
		//alert('1');
		if (!isRunInApp()){	//若在browser執行，則不註冊GCM/APNS
			unBlockUI();
			MsgBox('您已成功登入!', function(){showPage('#home');});
			return;
		}
		var DeviceType = getPlatformName();
		if (notEmpty(DeviceType) && DeviceType=='iOS')		DeviceType = "I";
		if (notEmpty(DeviceType) && DeviceType=='Android')	DeviceType = "A";
		if (beEmpty(DeviceType) || (DeviceType!='I' && DeviceType!='A')){	//若不是Android或iOS裝置，則不註冊GCM/APNS
			unBlockUI();
			MsgBox('您已成功登入!', function(){showPage('#home');});
			return;
		}
		var hasRegistered = getLocalValue("PushMessageRegister");
		if (beEmpty(hasRegistered) || hasRegistered!='Y' || msisdn!=getLocalValue('msisdn')){	//尚未註冊GCM/APNS，或目前登入的用戶與前次登入的門號不同，開始進行註冊
			//alert('hasRegistered=' + hasRegistered);
			showBlockUI();
			var pushNotification;
			pushNotification = window.plugins.pushNotification;
			if (DeviceType=='A'){	//Android裝置
				//alert('3');
				pushNotification.register(
					successHandler,
					errorHandler, {
					"senderID":"998389896458",
					"ecb":"onNotificationGCM"
				});
			}else{	//iOS裝置
				//alert('4');
				pushNotification.register(
					tokenHandler,
					errorHandler, {
						"badge":"true",
						"sound":"true",
						"alert":"true",
						"ecb":"onNotificationAPN"
				});
			}	//if (DeviceType=='A'){	//Android裝置
		}else{
			unBlockUI();
			window.plugins.toast.showShortCenter('您已成功登入!');
			showPage('#home');
		}	//if (beEmpty(hasRegistered) || hasRegistered!='Y'){	//尚未註冊GCM/APNS，開始進行註冊
	}	//function doPushMessageRegister(msisdn, contractid){	//檢查是否有註冊GCM/APNS Push Message，若未註冊則進行註冊

	function successHandler (result) {
		//setLocalValue('PushMessageRegister', 'Y');
		//alert('result = ' + result);
	}

	function errorHandler (error) {
		alert('推播通知發生錯誤 = ' + error);
	}

	function tokenHandler (result) {
		// Your iOS push server needs to know the token before it can push to this device
		// here is where you might want to send it the token for later use.
		
		//alert('device token = ' + result);
		if (beEmpty(result)) return;
		
		var sData = "";
		sData = "ServiceId=myvibo";
		sData += "&DeviceId=" + result;
		sData += "&DeviceType=" + "I";
		sData += "&MSISDN=" + getLocalValue('loginmsisdn');
		sData += "&ContractId=" + getLocalValue('logincontractid');
		sData += "&ResponseType=" + "xml";

		getDataFromServer("ajaxPushMessageAddDevice.jsp", sData, "xml", function(xml){
			var ResultCode = $(xml).find("ResultCode").text();
			var ResultText = $(xml).find("ResultText").text();
			unBlockUI();
			if (ResultCode!='00000'){	//作業失敗
				pushNotification.unregister(successHandler, errorHandler);
				MsgBox('訊息通知註冊失敗：' + ResultText, function(){showPage('#home');});
				return;
			}	//if (ResultCode=='00000'){	//作業成功
			setLocalValue('PushMessageRegister', 'Y');
			setLocalValue('PushMessageDeviceId', result);
			setLocalValue('AutoPushNotification', 'Y');	//自動發送及接收
			window.plugins.toast.showShortCenter('訊息通知註冊成功');
			showPage('#home');
		});
	}	//function tokenHandler (result) {

	// iOS
	function onNotificationAPN (event) {	//收到APNS推播訊息
		setLocalValue('PushMessageRegister', 'Y');
		if ( event.alert ){
			//navigator.notification.alert(event.alert);
		}
		
		if ( event.exp ){
			//navigator.notification.alert(event.exp);
		}

		if ( event.sound ){
			var snd = new Media(event.sound);
			snd.play();
		}
		
		if ( event.badge ){
			pushNotification.setApplicationIconBadgeNumber(successHandler, errorHandler, event.badge);
		}
	}	//function onNotificationAPN (event) {	//收到APNS推播訊息

	// Android
	function onNotificationGCM(e) {	//收到GCM推播訊息
		//$("#app-status-ul").append('<li>EVENT -> RECEIVED:' + e.event + '</li>');
		//cordova.exec(null, null, 'Notification', 'alert', ['11', 'Notification', 'OK']);
		switch( e.event )
		{
			case 'registered':
				//cordova.exec(null, null, 'Notification', 'alert', ['12', 'Notification', 'OK']);
				if ( e.regid.length > 0 )
				{
					//cordova.exec(null, null, 'Notification', 'alert', ['13', 'Notification', 'OK']);
					//$("#app-status-ul").append('<li>REGISTERED -> REGID:' + e.regid + "</li>");
					// Your GCM push server needs to know the regID before it can push to this device
					// here is where you might want to send it the regID for later use.
					//console.log("regID = " + e.regid);
					var sData = "";
					sData = "ServiceId=myvibo";
					sData += "&DeviceId=" + e.regid;
					sData += "&DeviceType=" + "A";
					sData += "&MSISDN=" + getLocalValue('loginmsisdn');
					sData += "&ContractId=" + getLocalValue('logincontractid');
					sData += "&ResponseType=" + "xml";
			
					getDataFromServer("ajaxPushMessageAddDevice.jsp", sData, "xml", function(xml){
						var ResultCode = $(xml).find("ResultCode").text();
						var ResultText = $(xml).find("ResultText").text();
						if (ResultCode!='00000'){	//作業失敗
							pushNotification.unregister(successHandler, errorHandler);
							MsgBox('訊息通知註冊失敗：' + ResultText, function(){showPage('#home');});
							return;
						}else{
							setLocalValue('PushMessageRegister', 'Y');
							setLocalValue('PushMessageDeviceId', e.regid);
							setLocalValue('AutoPushNotification', 'Y');	//自動發送及接收
							window.plugins.toast.showShortCenter('訊息通知註冊成功');
							showPage('#home');
						}	//if (ResultCode=='00000'){	//作業成功
					});
				}
				unBlockUI();
			break;
			
			case 'message':
				//cordova.exec(null, null, 'Notification', 'alert', ['14', 'Notification', 'OK']);
				// if this flag is set, this notification happened while we were in the foreground.
				// you might want to play a sound to get the user's attention, throw up a dialog, etc.
				if ( e.foreground )
				{
					//cordova.exec(null, null, 'Notification', 'alert', ['14', 'Notification', 'OK']);
					//alert(e.payload.message);
					//$("#app-status-ul").append('<li>--INLINE NOTIFICATION--' + '</li>');
					
					// if the notification contains a soundname, play it.
					//var my_media = new Media("/android_asset/www/"+e.soundname);
					//my_media.play();
				}
				else
				{  // otherwise we were launched because the user touched a notification in the notification tray.
					if ( e.coldstart )
					{
						//cordova.exec(null, null, 'Notification', 'alert', ['15', 'Notification', 'OK']);
						//$("#app-status-ul").append('<li>--COLDSTART NOTIFICATION--' + '</li>');
					}
					else
					{
						//cordova.exec(null, null, 'Notification', 'alert', ['16', 'Notification', 'OK']);
						//$("#app-status-ul").append('<li>--BACKGROUND NOTIFICATION--' + '</li>');
					}
				}
				
				//$("#app-status-ul").append('<li>MESSAGE -> MSG: ' + e.payload.message + '</li>');
				//$("#app-status-ul").append('<li>MESSAGE -> MSGCNT: ' + e.payload.msgcnt + '</li>');
			break;
			
			case 'error':
				unBlockUI();
				alert('推播通知發生錯誤');
				//$("#app-status-ul").append('<li>ERROR -> MSG:' + e.msg + '</li>');
			break;
			
			default:
				unBlockUI();
				//alert('default');
				//$("#app-status-ul").append('<li>EVENT -> Unknown, an event was received and we do not know what it is</li>');
			break;
		}
	}	//function onNotificationGCM(e) {	//收到GCM推播訊息

</script>
